buildscript {
    ext {
        fsRuntimeVersion = '5.2.230212'
        fsIsolationCheckVersion = '5.2.230212' // update regularly to test against newest FirstSpirit release
        assertjVersion = '3.13.2'
        junitVersion = '5.5.1'
        mockitoVersion = '3.0.0'
    }

    repositories {
        maven {
            url = 'https://artifactory.e-spirit.hosting/artifactory/repo/'
            credentials {
                username = artifactory_hosting_username
                password = artifactory_hosting_password
            }
        }
    }

    dependencies {
        classpath "de.espirit.firstspirit:fs-isolated-server:${fsRuntimeVersion}"
    }
}

plugins {
    id 'java-library'
    id 'maven-publish'
    id 'de.espirit.firstspirit-module' version '4.1.1'
    id 'net.researchgate.release' version '2.8.1'
}

allprojects {
    p ->
        apply plugin: 'java'

        group = 'com.canto'

        repositories {
            maven {
                url = 'https://artifactory.e-spirit.hosting/artifactory/repo/'
                credentials {
                    // Do NOT edit these lines since the credentials will be read from the local Gradle configuration.
                    username = artifactory_hosting_username
                    password = artifactory_hosting_password
                }
            }
            gradlePluginPortal()
        }

        compileJava.options.encoding = 'UTF-8'
        compileTestJava.options.encoding = 'UTF-8'

        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
}

configurations {
    fsLicense
}

dependencies {
    fsServerCompile project(':server')
    fsWebCompile project(':server')

    fsModuleCompile group: "com.espirit.ps.psci.module", name: "generic-configuration", version: "2.8.0"
    fsModuleCompile group: "com.espirit.ps.psci.module", name: "magic-icons", version: "2.1.0"
    fsModuleCompile group: "com.squareup.okhttp3", name: "okhttp", version: "4.1.0"
    fsModuleCompile group: "com.squareup.moshi", name: "moshi", version: "1.8.0"

    compileOnly group: 'de.espirit.firstspirit', name: 'fs-isolated-runtime', version: "${fsRuntimeVersion}"

    testImplementation 'junit:junit:4.13.2'
}

/*
 * FirstSpirit Module Gradle Plugin configuration
 */

def serverHttpPort = 0
new ServerSocket(0).withCloseable {
    port1 -> serverHttpPort = port1.getLocalPort()
}

firstSpiritModule {
    moduleName = 'CantoSaasConnector'
    displayName = 'Canto Connector'
    vendor = 'Canto Inc.'
    isolationDetectorUrl = 'https://fsdev.e-spirit.com/FsmDependencyDetector/'
    firstSpiritVersion = "${fsIsolationCheckVersion}"
    complianceLevel = 'HIGHEST'
}

release {
    ignoredSnapshotDependencies = ['de.espirit.firstspirit:fs-license']
}
